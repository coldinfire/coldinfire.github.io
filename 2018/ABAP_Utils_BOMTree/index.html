<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  
  
  
  
  
  <link rel="prev" href="https://coldinfire.github.io/2018/SAPWebDynproABAP_ClintTransfer/" />
  <link rel="next" href="https://coldinfire.github.io/2018/ABAP_Excel_Template/" />
  <link rel="canonical" href="https://coldinfire.github.io/2018/ABAP_Utils_BOMTree/" />
  <link rel='shortcut icon' type='image/x-icon' href='/favicon.ico' />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
            ALV tree 显示BOM结构  | Small Fire`s Blog
       
  </title>
  <meta name="title" content=" ALV tree 显示BOM结构  | Small Fire`s Blog">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=" ALV tree 显示BOM结构 "/>
<meta name="twitter:description" content="实例代码 REPORT z_barry_alv_tree1_bom MESSAGE-ID oo. TABLES: stpox. INCLUDE &lt;icon&gt;. CLASS: cl_gui_column_tree DEFINITION LOAD, cl_gui_cfw DEFINITION LOAD . DATA: tree1 TYPE REF TO cl_gui_alv_tree , mr_toolbar TYPE REF TO cl_gui_toolbar . DATA: gs_stpox TYPE stpox, gt_stpox TYPE stpox OCCURS 0, gt_fieldcatalog TYPE lvc_t_fcat, gt_item_layout TYPE lvc_t_laci, gs_item_layout TYPE lvc_s_laci, okcode LIKE sy-ucomm . TYPES: BEGIN OF gs_f. INCLUDE STRUCTURE stpox. TYPES: node_key TYPE lvc_nkey, END OF gs_f. DATA:"/>

  <script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": " ALV tree 显示BOM结构 ",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/coldinfire.github.io\/2018\/ABAP_Utils_BOMTree\/"
  },
  "image": {
    "@type": "ImageObject",
    "url": "https:\/\/coldinfire.github.io\/cover.png",
    "width":  800 ,
    "height":  600 
  },
  "genre": "posts",
  "keywords": "BOM, abaputils",
  "wordcount":  906 ,
  "url": "https:\/\/coldinfire.github.io\/2018\/ABAP_Utils_BOMTree\/",
  "datePublished": "2018-11-08T00:00:00\x2b00:00",
  "dateModified": "2018-11-08T00:00:00\x2b00:00",
  
  "publisher": {
    "@type": "Organization",
    "name": "SmallFire",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/coldinfire.github.io\/logo.png",
      "width":  127 ,
      "height":  40 
    }
  },
  "author": {
    "@type": "Person",
    "name": "Small Fire"
  },
  "description": ""
}
</script>
</head>

  



  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="https://coldinfire.github.io">Small Fire`s Blog</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/books/" title="">Books</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
                <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-sun"></i></a>&nbsp;
                <a href="/search/" class="search"><i class="iconfont icon-t"></i></a>&nbsp;
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-sun"></i></a>&nbsp;<a href="https://coldinfire.github.io">Small Fire`s Blog</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/books/" title="">Books</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>

    	 <main class="main">
          <div class="container">
      		
<article class="post-warp">
    <header class="post-header">
        <h1 class="post-title"> ALV tree 显示BOM结构 </h1>
        <div class="post-meta">
            Written by <a href="https://coldinfire.github.io" rel="author">Small Fire</a> with ♥ 
                <span class="post-time">
                    on <time datetime=2018-11-08 >8 November 2018</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://coldinfire.github.io/categories/ABAP/"> ABAP </a>
                        
                </span>
                <i class="iconfont icon-timer"></i>
                2 min
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          <h3 id="实例代码">实例代码</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ABAP" data-lang="ABAP"><span style="color:#66d9ef">REPORT</span> z_barry_alv_tree1_bom <span style="color:#66d9ef">MESSAGE-ID</span> oo.
<span style="color:#66d9ef">TABLES</span>: stpox.
<span style="color:#66d9ef">INCLUDE</span> &lt;icon&gt;.
<span style="color:#66d9ef">CLASS</span>: cl_gui_column_tree <span style="color:#66d9ef">DEFINITION</span> <span style="color:#66d9ef">LOAD</span>,
       cl_gui_cfw <span style="color:#66d9ef">DEFINITION</span> <span style="color:#66d9ef">LOAD</span> .
<span style="color:#66d9ef">DATA</span>: tree1  <span style="color:#66d9ef">TYPE REF TO</span> cl_gui_alv_tree ,
      mr_toolbar <span style="color:#66d9ef">TYPE REF TO</span> cl_gui_toolbar .
<span style="color:#66d9ef">DATA</span>: gs_stpox       <span style="color:#66d9ef">TYPE </span>stpox,
      gt_stpox       <span style="color:#66d9ef">TYPE </span>stpox OCCURS <span style="color:#ae81ff">0</span>,
      gt_fieldcatalog  <span style="color:#66d9ef">TYPE </span>lvc_t_fcat,
      gt_item_layout   <span style="color:#66d9ef">TYPE </span>lvc_t_laci,
      gs_item_layout   <span style="color:#66d9ef">TYPE </span>lvc_s_laci,
      okcode           <span style="color:#66d9ef">LIKE </span>sy<span style="color:#f92672">-</span>ucomm .
<span style="color:#66d9ef">TYPES</span>: <span style="color:#66d9ef">BEGIN OF</span> gs_f.
        <span style="color:#66d9ef">INCLUDE</span> STRUCTURE stpox.
<span style="color:#66d9ef">TYPES</span>: node_key      <span style="color:#66d9ef">TYPE </span>lvc_nkey,
       <span style="color:#66d9ef">END   OF</span> gs_f.
<span style="color:#66d9ef">DATA</span>: gs_xstpox       <span style="color:#66d9ef">TYPE </span>gs_f ,
      gt_xstpox       <span style="color:#66d9ef">TYPE </span>gs_f OCCURS <span style="color:#ae81ff">0</span>.
<span style="color:#66d9ef">DATA</span>: l_custom_container <span style="color:#66d9ef">TYPE REF TO</span> cl_gui_custom_container.
<span style="color:#66d9ef">DATA</span>: wa_topmat <span style="color:#66d9ef">TYPE </span>cstmat,
      wa_dstst <span style="color:#66d9ef">TYPE </span>csdata<span style="color:#f92672">-</span>xfeld.
<span style="color:#66d9ef">DATA</span>: it_matcat <span style="color:#66d9ef">TYPE STANDARD TABLE OF</span> cscmat.

<span style="color:#66d9ef">PARAMETERS</span>: p_matnr <span style="color:#66d9ef">LIKE </span>mara<span style="color:#f92672">-</span>matnr <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;YW25K&#39;</span>,
            p_werks <span style="color:#66d9ef">LIKE </span>ekpo<span style="color:#f92672">-</span>werks <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;1010&#39;</span> .

<span style="color:#66d9ef">START-OF-SELECTION</span>.
  <span style="color:#66d9ef">PERFORM</span> <span style="color:#a6e22e">getdata</span>.
  <span style="color:#66d9ef">CALL SCREEN</span> <span style="color:#ae81ff">9000</span>.
<span style="color:#75715e">*&amp;---------------------------------------------------------------------*</span>
<span style="color:#75715e">*&amp;      Form  getdata</span>
<span style="color:#75715e">*&amp;---------------------------------------------------------------------*</span>
<span style="color:#66d9ef">FORM</span> <span style="color:#a6e22e">getdata</span>.
  <span style="color:#66d9ef">CALL FUNCTION</span> <span style="color:#e6db74">&#39;CS_BOM_EXPL_MAT_V2&#39;</span>
    <span style="color:#66d9ef">EXPORTING</span>
      capid                 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;CAD1&#39;</span>     <span style="color:#75715e">&#34;p_capid&#34;
</span><span style="color:#75715e"></span>      datuv                 <span style="color:#f92672">=</span> sy<span style="color:#f92672">-</span>datum
      mehrs                 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;X&#39;</span>        <span style="color:#75715e">&#34;p_mehrs&#34;
</span><span style="color:#75715e"></span>      stlal                 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;01&#39;</span>       <span style="color:#75715e">&#34;可选 BOM&#34;
</span><span style="color:#75715e"></span>      stlan                 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;2&#39;</span>        <span style="color:#75715e">&#34;BOM 用途&#34;
</span><span style="color:#75715e"></span>      mtnrv                 <span style="color:#f92672">=</span> P_MATNR
      werks                 <span style="color:#f92672">=</span> P_WERKS
      emeng                 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">IMPORTING</span>
      topmat                <span style="color:#f92672">=</span> wa_topmat
      dstst                 <span style="color:#f92672">=</span> wa_dstst
    <span style="color:#66d9ef">TABLES</span>
      stb                   <span style="color:#f92672">=</span> gt_stpox
      matcat                <span style="color:#f92672">=</span> it_matcat
    <span style="color:#66d9ef">EXCEPTIONS</span>
      alt_not_found         <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
      call_invalid          <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
      material_not_found    <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
      missing_authorization <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
      no_bom_found          <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
      no_plant_data         <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>
      no_suitable_bom_found <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>
      conversion_error      <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
      <span style="color:#66d9ef">OTHERS</span>                <span style="color:#f92672">=</span> <span style="color:#ae81ff">9</span>.
  <span style="color:#66d9ef">CASE</span> sy<span style="color:#f92672">-</span>subrc .
    <span style="color:#66d9ef">WHEN</span> <span style="color:#ae81ff">1</span> .
      <span style="color:#66d9ef">MESSAGE</span> e899(fi) <span style="color:#66d9ef">WITH</span> <span style="color:#e6db74">&#39;alt_not_found&#39;</span>.
    <span style="color:#66d9ef">WHEN</span> <span style="color:#ae81ff">2</span> .
      <span style="color:#66d9ef">MESSAGE</span> e899(fi) <span style="color:#66d9ef">WITH</span> <span style="color:#e6db74">&#39;call_invalid &#39;</span>.
    <span style="color:#66d9ef">WHEN</span> <span style="color:#ae81ff">3</span> .
      <span style="color:#66d9ef">MESSAGE</span> e899(fi) <span style="color:#66d9ef">WITH</span> <span style="color:#e6db74">&#39;material_not_found&#39;</span>.
    <span style="color:#66d9ef">WHEN</span> <span style="color:#ae81ff">4</span> .
      <span style="color:#66d9ef">MESSAGE</span> e899(fi) <span style="color:#66d9ef">WITH</span> <span style="color:#e6db74">&#39;missing_authorization&#39;</span>.
    <span style="color:#66d9ef">WHEN</span> <span style="color:#ae81ff">5</span> .
      <span style="color:#66d9ef">MESSAGE</span> e899(fi) <span style="color:#66d9ef">WITH</span> <span style="color:#e6db74">&#39;no_bom_found&#39;</span>.
    <span style="color:#66d9ef">WHEN</span> <span style="color:#ae81ff">6</span> .
      <span style="color:#66d9ef">MESSAGE</span> e899(fi) <span style="color:#66d9ef">WITH</span> <span style="color:#e6db74">&#39;no_plant_data&#39;</span>.
    <span style="color:#66d9ef">WHEN</span> <span style="color:#ae81ff">7</span> .
      <span style="color:#66d9ef">MESSAGE</span> e899(fi) <span style="color:#66d9ef">WITH</span> <span style="color:#e6db74">&#39;no_suitable_bom_found&#39;</span>.
    <span style="color:#66d9ef">WHEN</span> <span style="color:#ae81ff">8</span> .
      <span style="color:#66d9ef">MESSAGE</span> e899(fi) <span style="color:#66d9ef">WITH</span> <span style="color:#e6db74">&#39;conversion_error&#39;</span>.
    <span style="color:#66d9ef">WHEN</span> <span style="color:#ae81ff">9</span> .
      <span style="color:#66d9ef">MESSAGE</span> e899(fi) <span style="color:#66d9ef">WITH</span> <span style="color:#e6db74">&#39;OTHERS Error&#39;</span>.
  <span style="color:#66d9ef">ENDCASE</span>.
  <span style="color:#66d9ef">LOOP AT </span>gt_stpox <span style="color:#66d9ef">INTO</span> gs_stpox.
    <span style="color:#66d9ef">MOVE-CORRESPONDING</span> gs_stpox <span style="color:#66d9ef">TO</span> gs_xstpox .
    <span style="color:#66d9ef">APPEND</span> gs_xstpox <span style="color:#66d9ef">TO</span> gt_xstpox.
  <span style="color:#66d9ef">ENDLOOP</span>.
<span style="color:#66d9ef">ENDFORM</span>.                    <span style="color:#75715e">&#34;getdata&#34;
</span><span style="color:#75715e"></span><span style="color:#75715e">*----------------------------------------------------------------------*</span>
<span style="color:#75715e">*  MODULE status_9000 OUTPUT</span>
<span style="color:#75715e">*----------------------------------------------------------------------*</span>
<span style="color:#66d9ef">MODULE</span> <span style="color:#a6e22e">status_9000</span> <span style="color:#66d9ef">OUTPUT</span>.
  <span style="color:#66d9ef">SET PF-STATUS</span> <span style="color:#e6db74">&#39;MAIN&#39;</span>.
  <span style="color:#66d9ef">SET TITLEBAR</span> <span style="color:#e6db74">&#39;TITLE&#39;</span>.
  <span style="color:#66d9ef">IF</span> tree1 <span style="color:#f92672">IS INITIAL</span>.
    <span style="color:#66d9ef">PERFORM</span> <span style="color:#a6e22e">init_tree</span>.
  <span style="color:#66d9ef">ENDIF</span>.
  <span style="color:#66d9ef">CALL METHOD</span> cl_gui_cfw<span style="color:#f92672">=</span><span style="color:#f92672">&gt;</span>flush.
<span style="color:#66d9ef">ENDMODULE</span>.                 <span style="color:#75715e">&#34; PBO_9000  OUTPUT &#34;
</span><span style="color:#75715e"></span><span style="color:#75715e">*----------------------------------------------------------------------*</span>
<span style="color:#75715e">*  MODULE user_command_9000 INPUT</span>
<span style="color:#75715e">*----------------------------------------------------------------------*</span>
<span style="color:#66d9ef">MODULE</span> <span style="color:#a6e22e">user_command_9000</span> <span style="color:#66d9ef">INPUT</span>.
  <span style="color:#66d9ef">CASE</span> okcode.
    <span style="color:#66d9ef">WHEN</span> <span style="color:#e6db74">&#39;EXIT&#39;</span> <span style="color:#f92672">OR</span> <span style="color:#e6db74">&#39;BACK&#39;</span> <span style="color:#f92672">OR</span> <span style="color:#e6db74">&#39;CANC&#39;</span>.
      <span style="color:#66d9ef">CALL METHOD</span> tree1<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>free.
      <span style="color:#66d9ef">LEAVE</span> <span style="color:#66d9ef">PROGRAM</span> .
    <span style="color:#66d9ef">WHEN</span> <span style="color:#66d9ef">OTHERS</span>.
      <span style="color:#66d9ef">CALL METHOD</span> cl_gui_cfw<span style="color:#f92672">=</span><span style="color:#f92672">&gt;</span>dispatch.
  <span style="color:#66d9ef">ENDCASE</span>.
  <span style="color:#66d9ef">CLEAR</span> okcode.
  <span style="color:#66d9ef">CALL METHOD</span> cl_gui_cfw<span style="color:#f92672">=</span><span style="color:#f92672">&gt;</span>flush.
<span style="color:#66d9ef">ENDMODULE</span>.                 <span style="color:#75715e">&#34; okcode  INPUT &#34;
</span><span style="color:#75715e"></span><span style="color:#75715e">*&amp;---------------------------------------------------------------------*</span>
<span style="color:#75715e">*&amp;      Form  init_tree</span>
<span style="color:#75715e">*&amp;---------------------------------------------------------------------*</span>
<span style="color:#66d9ef">FORM</span> <span style="color:#a6e22e">init_tree</span> .
  <span style="color:#66d9ef">PERFORM</span> <span style="color:#a6e22e">build_fieldcatalog</span>.
<span style="color:#75715e">* IF sy-batch IS INITIAL.</span>
<span style="color:#75715e">* CREATE OBJECT l_custom_container</span>
<span style="color:#75715e">* EXPORTING</span>
<span style="color:#75715e">* container_name              = &#39;TREE1&#39;</span>
<span style="color:#75715e">* EXCEPTIONS</span>
<span style="color:#75715e">* cntl_error                  = 1</span>
<span style="color:#75715e">* cntl_system_error           = 2</span>
<span style="color:#75715e">* create_error                = 3</span>
<span style="color:#75715e">* lifetime_error              = 4</span>
<span style="color:#75715e">* lifetime_dynpro_dynpro_link = 5.</span>
<span style="color:#75715e">* IF sy-subrc &lt;&gt; 0.</span>
<span style="color:#75715e">* MESSAGE e000 WITH &#39; 创建容器：TREE1 错误 &#39;.</span>
<span style="color:#75715e">* ENDIF.</span>
<span style="color:#75715e">* ENDIF.</span>
  <span style="color:#66d9ef">CREATE OBJECT</span> tree1
    <span style="color:#66d9ef">EXPORTING</span>
<span style="color:#75715e">*     parent                      = l_custom_container</span>
      parent                      <span style="color:#f92672">=</span> cl_gui_container<span style="color:#f92672">=</span><span style="color:#f92672">&gt;</span>screen0
      node_selection_mode         <span style="color:#f92672">=</span> cl_gui_column_tree<span style="color:#f92672">=</span><span style="color:#f92672">&gt;</span>node_sel_mode_single
      item_selection              <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;X&#39;</span>
      no_html_header              <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;X&#39;</span>
      no_toolbar                  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39; &#39;</span>
    <span style="color:#66d9ef">EXCEPTIONS</span>
      cntl_error                  <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
      cntl_system_error           <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
      create_error                <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
      lifetime_error              <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
      illegal_node_selection_mode <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
      failed                      <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>
      illegal_column_name         <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>.
  <span style="color:#66d9ef">IF</span> sy<span style="color:#f92672">-</span>subrc <span style="color:#f92672">&lt;</span><span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>.
    <span style="color:#66d9ef">MESSAGE</span> e000 <span style="color:#66d9ef">WITH</span> <span style="color:#e6db74">&#39; 创建 TREE 错误 &#39;</span>.
  <span style="color:#66d9ef">ENDIF</span>.
  <span style="color:#66d9ef">DATA</span> l_hierarchy_header <span style="color:#66d9ef">TYPE </span>treev_hhdr.
  <span style="color:#66d9ef">PERFORM</span> <span style="color:#a6e22e">build_hierarchy_header</span> <span style="color:#66d9ef">CHANGING</span> l_hierarchy_header.
  <span style="color:#66d9ef">DATA</span>: ls_variant <span style="color:#66d9ef">TYPE </span>disvariant.
  ls_variant<span style="color:#f92672">-</span>report <span style="color:#f92672">=</span> sy<span style="color:#f92672">-</span>repid.
  <span style="color:#66d9ef">CALL METHOD</span> tree1<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>set_table_for_first_display
    <span style="color:#66d9ef">EXPORTING</span>
      is_hierarchy_header <span style="color:#f92672">=</span> l_hierarchy_header
      i_background_id     <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ALV_BACKGROUND&#39;</span>
      i_save              <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A&#39;</span>
      is_variant          <span style="color:#f92672">=</span> ls_variant
    <span style="color:#66d9ef">CHANGING</span>
      it_outtab           <span style="color:#f92672">=</span> gt_stpox        <span style="color:#75715e">&#34;table must be emty !!&#34;
</span><span style="color:#75715e"></span>      it_fieldcatalog     <span style="color:#f92672">=</span> gt_fieldcatalog.
  <span style="color:#66d9ef">DATA</span>: l1 <span style="color:#66d9ef">TYPE </span>lvc_nkey ,l2 <span style="color:#66d9ef">TYPE </span>lvc_nkey ,l3 <span style="color:#66d9ef">TYPE </span>lvc_nkey ,l4 <span style="color:#66d9ef">TYPE </span>lvc_nkey ,
        l5 <span style="color:#66d9ef">TYPE </span>lvc_nkey ,l6 <span style="color:#66d9ef">TYPE </span>lvc_nkey ,l7 <span style="color:#66d9ef">TYPE </span>lvc_nkey ,l8 <span style="color:#66d9ef">TYPE </span>lvc_nkey ,
        l_key <span style="color:#66d9ef">TYPE </span>lvc_nkey,
        l_last_key <span style="color:#66d9ef">TYPE </span>lvc_nkey  ,
        added .
  <span style="color:#66d9ef">LOOP AT </span>gt_xstpox <span style="color:#66d9ef">INTO</span> gs_xstpox .
    <span style="color:#66d9ef">MOVE-CORRESPONDING</span> gs_xstpox <span style="color:#66d9ef">TO</span> gs_stpox.
    <span style="color:#66d9ef">CASE</span> gs_stpox<span style="color:#f92672">-</span>stufe .
      <span style="color:#66d9ef">WHEN</span> <span style="color:#e6db74">&#39;1&#39;</span>.
        l_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>.
      <span style="color:#66d9ef">WHEN</span> <span style="color:#e6db74">&#39;2&#39;</span>.
        l_key <span style="color:#f92672">=</span> l1.
      <span style="color:#66d9ef">WHEN</span> <span style="color:#e6db74">&#39;3&#39;</span>.
        l_key <span style="color:#f92672">=</span> l2.
      <span style="color:#66d9ef">WHEN</span> <span style="color:#e6db74">&#39;4&#39;</span>.
        l_key <span style="color:#f92672">=</span> l3.
      <span style="color:#66d9ef">WHEN</span> <span style="color:#e6db74">&#39;5&#39;</span>.
        l_key <span style="color:#f92672">=</span> l4.
      <span style="color:#66d9ef">WHEN</span> <span style="color:#e6db74">&#39;6&#39;</span>.
        l_key <span style="color:#f92672">=</span> l5.
    <span style="color:#66d9ef">ENDCASE</span>.
    <span style="color:#66d9ef">PERFORM</span> <span style="color:#a6e22e">add_complete_line</span> <span style="color:#66d9ef">USING</span>  gs_stpox l_key
                            <span style="color:#66d9ef">CHANGING</span> l_last_key.
    gs_xstpox<span style="color:#f92672">-</span>node_key <span style="color:#f92672">=</span> l_last_key.
    <span style="color:#66d9ef">CASE</span> gs_stpox<span style="color:#f92672">-</span>stufe .
      <span style="color:#66d9ef">WHEN</span> <span style="color:#e6db74">&#39;1&#39;</span>.
        l1 <span style="color:#f92672">=</span> l_last_key.
      <span style="color:#66d9ef">WHEN</span> <span style="color:#e6db74">&#39;2&#39;</span>.
        l2 <span style="color:#f92672">=</span> l_last_key.
      <span style="color:#66d9ef">WHEN</span> <span style="color:#e6db74">&#39;3&#39;</span>.
        l3 <span style="color:#f92672">=</span> l_last_key.
      <span style="color:#66d9ef">WHEN</span> <span style="color:#e6db74">&#39;4&#39;</span>.
        l4 <span style="color:#f92672">=</span> l_last_key.
      <span style="color:#66d9ef">WHEN</span> <span style="color:#e6db74">&#39;5&#39;</span>.
        l5 <span style="color:#f92672">=</span> l_last_key.
      <span style="color:#66d9ef">WHEN</span> <span style="color:#e6db74">&#39;6&#39;</span>.
        l6 <span style="color:#f92672">=</span> l_last_key.
    <span style="color:#66d9ef">ENDCASE</span>.
    <span style="color:#66d9ef">MODIFY</span> gt_xstpox <span style="color:#66d9ef">FROM</span> gs_xstpox .
  <span style="color:#66d9ef">ENDLOOP</span>.
  <span style="color:#66d9ef">CALL METHOD</span> tree1<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>update_calculations.
  <span style="color:#66d9ef">CALL METHOD</span> tree1<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>frontend_update.
<span style="color:#66d9ef">ENDFORM</span>.                    <span style="color:#75715e">&#34; init_tree &#34;
</span><span style="color:#75715e"></span><span style="color:#75715e">*&amp;---------------------------------------------------------------------*</span>
<span style="color:#75715e">*&amp;      Form  build_fieldcatalog</span>
<span style="color:#75715e">*&amp;---------------------------------------------------------------------*</span>
<span style="color:#66d9ef">FORM</span> <span style="color:#a6e22e">build_fieldcatalog</span>.
  <span style="color:#66d9ef">CALL FUNCTION</span> <span style="color:#e6db74">&#39;LVC_FIELDCATALOG_MERGE&#39;</span>
    <span style="color:#66d9ef">EXPORTING</span>
      i_structure_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;STPOX&#39;</span>
    <span style="color:#66d9ef">CHANGING</span>
      ct_fieldcat      <span style="color:#f92672">=</span> gt_fieldcatalog.

  <span style="color:#66d9ef">DATA</span>: ls_fieldcatalog <span style="color:#66d9ef">TYPE </span>lvc_s_fcat.
  <span style="color:#66d9ef">LOOP AT </span>gt_fieldcatalog <span style="color:#66d9ef">INTO</span> ls_fieldcatalog.

<span style="color:#75715e">* CASE ls_fieldcatalog-fieldname.</span>
<span style="color:#75715e">* WHEN &#39;CARRID&#39; OR &#39;CONNID&#39; OR &#39;FLDATE&#39;.</span>
<span style="color:#75715e">* ls_fieldcatalog-no_out = &#39;X&#39;.</span>
<span style="color:#75715e">* ls_fieldcatalog-key    = &#39;&#39;.</span>
<span style="color:#75715e">* WHEN &#39;PRICE&#39; OR &#39;SEATSOCC&#39; OR &#39;SEATSMAX&#39; OR &#39;PAYMENTSUM&#39;.</span>
<span style="color:#75715e">**        ls_fieldcatalog-do_sum = &#39;X&#39;.</span>
<span style="color:#75715e">* WHEN &#39;PLANETYPE&#39;.</span>
<span style="color:#75715e">* ls_fieldcatalog-edit = &#39;X&#39;.</span>
<span style="color:#75715e">* ls_fieldcatalog-style = cl_gui_alv_grid=&gt;mc_style_enabled .</span>
<span style="color:#75715e">* ENDCASE.</span>
  <span style="color:#66d9ef">MODIFY</span> gt_fieldcatalog <span style="color:#66d9ef">FROM</span> ls_fieldcatalog.
  <span style="color:#66d9ef">ENDLOOP</span>.
  <span style="color:#66d9ef">ENDFORM</span>.                               <span style="color:#75715e">&#34; build_fieldcatalog &#34;
</span><span style="color:#75715e"></span><span style="color:#75715e">*&amp;---------------------------------------------------------------------*</span>
<span style="color:#75715e">*&amp;      Form  build_hierarchy_header</span>
<span style="color:#75715e">*&amp;---------------------------------------------------------------------*</span>
<span style="color:#66d9ef">FORM</span> <span style="color:#a6e22e">build_hierarchy_header</span> <span style="color:#66d9ef">CHANGING</span> p_hierarchy_header <span style="color:#66d9ef">TYPE </span>treev_hhdr.
  p_hierarchy_header<span style="color:#f92672">-</span>heading <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;BOM 层次 &#39;</span>.
  p_hierarchy_header<span style="color:#f92672">-</span>tooltip <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ToolTip&#39;</span>.
  p_hierarchy_header<span style="color:#f92672">-</span>width <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>.
  p_hierarchy_header<span style="color:#f92672">-</span>width_pix <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>.
<span style="color:#66d9ef">ENDFORM</span>.                               <span style="color:#75715e">&#34; build_hierarchy_header &#34;
</span><span style="color:#75715e"></span><span style="color:#75715e">*&amp;---------------------------------------------------------------------*</span>
<span style="color:#75715e">*&amp;      Form  add_complete_line</span>
<span style="color:#75715e">*&amp;---------------------------------------------------------------------*</span>
<span style="color:#66d9ef">FORM</span> <span style="color:#a6e22e">add_complete_line</span> <span style="color:#66d9ef">USING</span>  ps_stpox <span style="color:#66d9ef">TYPE </span>stpox
                              p_relat_key <span style="color:#66d9ef">TYPE </span>lvc_nkey
                     <span style="color:#66d9ef">CHANGING</span> p_node_key <span style="color:#66d9ef">TYPE </span>lvc_nkey.
  <span style="color:#66d9ef">DATA</span>: l_node_text <span style="color:#66d9ef">TYPE </span>lvc_value.
<span style="color:#75715e">*Set item-layout</span>
  <span style="color:#66d9ef">DATA</span>: lt_item_layout <span style="color:#66d9ef">TYPE </span>lvc_t_layi,
        ls_item_layout <span style="color:#66d9ef">TYPE </span>lvc_s_layi.
  <span style="color:#66d9ef">DATA</span>: stufe_num(<span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">TYPE </span>n.
  ls_item_layout<span style="color:#f92672">-</span>fieldname <span style="color:#f92672">=</span> tree1<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>c_hierarchy_column_name.
  ls_item_layout<span style="color:#f92672">-</span>class     <span style="color:#f92672">=</span> cl_gui_column_tree<span style="color:#f92672">=</span><span style="color:#f92672">&gt;</span>item_class_text.
<span style="color:#75715e">* ls_item_layout-editable  = &#39;X&#39;.</span>
<span style="color:#75715e">* ls_item_layout-chosen    = &#39;X&#39;.  &#34;设置为选中状态&#34;</span>
  <span style="color:#66d9ef">APPEND</span> ls_item_layout <span style="color:#66d9ef">TO</span> lt_item_layout.
<span style="color:#75715e">* l_node_text =  ps_stpox-ojtxp.</span>
  stufe_num <span style="color:#f92672">=</span> ps_stpox<span style="color:#f92672">-</span>stufe.
  <span style="color:#66d9ef">CONCATENATE</span> stufe_num <span style="color:#e6db74">&#39;,&#39;</span> ps_stpox<span style="color:#f92672">-</span>ojtxp <span style="color:#66d9ef">INTO</span> l_node_text.
  <span style="color:#66d9ef">CALL METHOD</span> tree1<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>add_node
    <span style="color:#66d9ef">EXPORTING</span>
      i_relat_node_key <span style="color:#f92672">=</span> p_relat_key
      i_relationship   <span style="color:#f92672">=</span> cl_gui_column_tree<span style="color:#f92672">=</span><span style="color:#f92672">&gt;</span>relat_last_child
      is_outtab_line   <span style="color:#f92672">=</span> ps_stpox
      i_node_text      <span style="color:#f92672">=</span> l_node_text
      it_item_layout   <span style="color:#f92672">=</span> lt_item_layout
    <span style="color:#66d9ef">IMPORTING</span>
      e_new_node_key   <span style="color:#f92672">=</span> p_node_key.
<span style="color:#66d9ef">ENDFORM</span>.                               <span style="color:#75715e">&#34; add_complete_line &#34;
</span></code></pre></div>
    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>Small Fire </span>
                </p>
            
           
            <p class="copyright-item">
                    <span>Words:</span>
                   <span>906</span>
            </p>
            
            <p class="copyright-item">
                
            </p>

            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-icon-tag"></i>Tag: 
            
            <span class="tag"><a href="https://coldinfire.github.io/tags/BOM/">
                    #BOM</a></span>
            
            <span class="tag"><a href="https://coldinfire.github.io/tags/abaputils/">
                    #abaputils</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">Back</a></span> · 
                <span><a href="https://coldinfire.github.io">Home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://coldinfire.github.io/2018/SAPWebDynproABAP_ClintTransfer/" class="prev" rel="prev" title=" Web Dynpro 在Portal上传输 "><i class="iconfont icon-dajiantou"></i>&nbsp; Web Dynpro 在Portal上传输 </a>
         
        
        <a href="https://coldinfire.github.io/2018/ABAP_Excel_Template/" class="next" rel="next" title=" SAP 上传和下载 Excel "> SAP 上传和下载 Excel &nbsp;<i class="iconfont icon-xiaojiantou"></i></a>
        
    </div>

    <div class="post-comment">
          
          <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var gitalk = new Gitalk({
        id: '2018-11-08 00:00:00 \x2b0000 UTC',
        title: ' ALV tree 显示BOM结构 ',
        clientID: 'd2cccd8844ae11b05792',
        clientSecret: 'cea63bc294ee16cb47a3344b693c350da1bb0753',
        repo: 'coldinfire.github.io',
        owner: 'coldinfire',
        admin: ['coldinfire'],
        body: decodeURI(location.href)
      });
      gitalk.render('gitalk-container');
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by gitalk.</a></noscript>
  


          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2017 - 2022</span>
        
         
            <span class="author" itemprop="copyrightHolder"><a href="https://coldinfire.github.io">Small Fire</a> | </span>
         

		  <span>Crafted with ❤️ by <a href="https://github.com/Fastbyte01/KeepIt" target="_blank" rel="external nofollow noopener noreffer">KeepIt</a> & <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a></span>
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  







     </div>
  </body>
</html>
